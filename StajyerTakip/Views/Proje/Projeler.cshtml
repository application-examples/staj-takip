
@{
    ViewData["Title"] = "Projeler";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using Microsoft.AspNetCore.Http
@{
    var yetki = Context.Session.GetInt32("yetki");
    var profilid = Context.Session.GetInt32("profilid");
    var id = Context.Session.GetInt32("id");

}
@if (yetki != 4)
{
    <div class="col-lg-12 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <nav class=" navbar navbar-light bg-white">
                    <a class="navbar-brand">Proje Ekle</a>

                    <button class="btn btn-success my-2 my-sm-0" type="button" data-toggle="modal" data-target="#projeekle">Ekle</button>
                </nav>
            </div>
        </div>
    </div>
}
<div class="col-lg-12 grid-margin stretch-card">
    <div class="card">
        <div class="card-body">
            <h4 class="card-title">Duyuru Listesi</h4>


            <div class="table-responsive">
                <table class="table table-striped table-bordered" id="projeler">
                    <thead class="text-info">
                        <tr>

                            <th class="font-weight-bold">
                                Proje Başlığı
                            </th>
                            <th class="font-weight-bold">
                                İçerik
                            </th>
                            <th class="font-weight-bold">
                                Başlangıç Tarihi
                            </th>
                            <th class="font-weight-bold">
                                Bitiş Tarihi
                            </th>
                            <th class="font-weight-bold">
                                Link(Git vb.)
                            </th>
                            <th class="font-weight-bold">
                                Görüntüle
                            </th>
                            @if (yetki != 4)
                            {
                                <th class="font-weight-bold">
                                    Düzenle
                                </th>
                                <th class="font-weight-bold">
                                    Sil
                                </th>
                            }
                        </tr>
                    </thead>
                    <tbody class="projelerbody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<input type="hidden" id="sessionauthid" value="@yetki" />
<input type="hidden" id="sessionprofileid" value="@profilid" />
<input type="hidden" id="sessionid" value="@id" />
<script>
    var projelistesi;
    var columns;
    var id;

    this.session_auth_id = $('#sessionauthid').val();
    this.session_profile_id = $('#sessionprofileid').val();
    this.session_id = $('#sessionid').val();
    $(function () {
        if (this.session_auth_id == 1 || this.session_auth_id == 2 || this.session_auth_id == 3) {
            columns = [
                { "data": "baslik" },
                { "data": "icerik" },
                { "data": "baslangic" },
                { "data": "bitis" },
                { "data": "link" },
                { "data": "goruntule", "width": "5%" },
                { "data": "duzenle", "width": "5%" },
                { "data": "sil", "width": "5%" }

            ];
        } if (this.session_auth_id == 4) {
            columns = [
                { "data": "baslik" },
                { "data": "icerik" },
                { "data": "baslangic" },
                { "data": "bitis" },
                { "data": "link" },
                { "data": "goruntule", "width": "10%" }

            ];
        }

        var projelericek = () => {
            $('#projeler').DataTable({
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.10.12/i18n/Turkish.json"
                },
                deferRender: true,
                "ordering": false,
                responsive: true,
                "ajax": {
                    url: '/Proje/ProjeleriCekJson',
                    type: 'GET',
                    "dataSrc": function (data) {
                        var return_data = new Array();
                        $.each(data, function (id, obj) {
                            if (document.session_auth_id == 1 || document.session_auth_id == 2 || document.session_auth_id == 3) {
                                console.log('girdi');
                                return_data.push({
                                    'baslik': obj.baslik,
                                    'icerik': obj.icerik.substr(0, Math.min(obj.duyuru.icerik.length, 72)),
                                    'baslangic': new Date(obj.baslangic).getDay().toString() + '/' + new Date(obj.baslangic).getMonth().toString() + new Date(obj.baslangic).getFullYear().toString(),
                                    'bitis': new Date(obj.bitis).getDay().toString() + '/' + new Date(obj.bitis).getMonth().toString() + new Date(obj.bitis).getFullYear().toString(),
                                    'link': obj.link,
                                    'goruntule': '<a class="btn btn-success" href="/Proje/Goruntule/' + obj.id + '"><span class="mdi mdi-eye text-white"></span> Görüntüle</a>',
                                    'duzenle': '<button type="button" class="btn btn-info duzenle"  id = "' + obj.duyuru.id + '" data-toggle="modal" data-target="#duyuruduzenle"><i class="mdi mdi-pencil text-white"></i> Düzenle</button>',
                                    'sil': '<button type="button" class="btn btn-danger sil" id = "' + obj.duyuru.id + '"><i class="mdi mdi-eraser text-white"></i> Sil</button>'
                                });
                            }
                            if (document.session_auth_id == 4) {
                                return_data.push({
                                    'baslik': obj.baslik,
                                    'icerik': obj.icerik.substr(0, Math.min(obj.duyuru.icerik.length, 72)),
                                    'baslangic': new Date(obj.baslangic).getDay().toString() + '/' + new Date(obj.baslangic).getMonth().toString() + new Date(obj.baslangic).getFullYear().toString(),
                                    'bitis': new Date(obj.bitis).getDay().toString() + '/' + new Date(obj.bitis).getMonth().toString() + new Date(obj.bitis).getFullYear().toString(),
                                    'link': obj.link,
                                    'goruntule': '<a class="btn btn-success" href="/Proje/Goruntule/' + obj.id + '"><i class="mdi mdi-eraser text-white"></i> Görüntüle</a>'
                                });
                            }
                        });
                        return return_data;

                    },
                },
                "columns": columns


            });
        }

    });
</script>